<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="TechBoard">

<typeAlias alias="techboard" type="pro.tech.vo.Tech"/>
	
<insert id="addTechBoard" parameterClass="techboard">
	insert into tech
	(tech_no, tech_title, tech_ques_content, tech_ans_content,
	  tech_active,  student_no, qtype_no)
	values
	(tech_no_seq.nextval, #title#, #quesContent#, #ansContent#,
		#active#, #student.no#, #qtypeNo#)
</insert>

<select id="getTotalRows" parameterClass="pro.criteria.vo.Criteria" resultClass="int">
	select count(*)
	from tech
	<dynamic>
		<isNotEmpty property="keyword" prepend="where">
			<isEqual property="opt" compareValue="title">
				tech_title like '%' || #keyword# || '%'
			</isEqual>
			<isEqual property="opt" compareValue="writer">
				student_no in (select student_no from student where student_name like '%' || #keyword# || '%')
			</isEqual>
		</isNotEmpty>
	</dynamic>
</select>

<select id="getAllTechBoard" parameterClass="pro.criteria.vo.Criteria" resultClass="techboard">
	select 
	"no" as no,
	"title" as title, 
	"quesContent" as quesContent,
	"quesRegdate" as quesRegdate,
	"ansContent"  as ansContent,
	"ansRegdate" as ansRegdate,
	"active" as active, 
	"student.no" as "student.no", 
	"qtypeNo" as qtypeNo
from (select row_number() over (order by tech_no asc) m,	A.tech_no   as "no",
															A.tech_title					as "title", 
															A.tech_ques_content				as "quesContent",
															A.tech_ques_regdate				as "quesRegdate",
															A.tech_ans_content				as	"ansContent",
															A.tech_ans_regdate				as	"ansRegdate",
														  	A.tech_active					as	"active", 
														  	A.student_no					as  "student.no", 
														  	A.qtype_no						as "qtypeNo"
														from
															tech A, student B
														where 
															A.student_no = B.student_no
	<dynamic>
		<isNotNull property="opt">
			<isNotNull property="keyword">
				<isEqual property="opt" compareValue="title">
					and A.tech_title like '%' || #keyword# || '%'
				</isEqual>
				<isEqual property="opt" compareValue="writer">
					and A.student_no in (select student_no from student where student_name like '%' || #keyword# || '%')  
				</isEqual>
			</isNotNull>
		</isNotNull>
	</dynamic>			
															)
where m >= #beginIndex# and m &lt;= #endIndex#
</select>

<update id="deleteTechBoardByNo" parameterClass="int">
	update tech
	set
		tech_active = 'N'
	where tech_no = #value#
</update>

<select id="getTechBoardByNo" parameterClass="int" resultClass="techboard">
select
		tech_no						as no, 
		tech_title					as title, 
		tech_ques_content			as quesContent,
		tech_ques_regdate			as quesRegdate,
		tech_ans_content			as	ansContent,
		tech_ans_regdate			as	ansRegdate,
	  	tech_active					as	active, 
	  	student_no					as  "student.no", 
	  	qtype_no					as qtypeNo
	from
		tech
	where
		tech_no = #value#
</select>

<update id="updateTechBoard" parameterClass="techboard">
	update tech
	set
		tech_ans_content = #ansContent#,
		tech_ans_regdate = sysdate
	where
		tech_no = #no#
</update>

</sqlMap>