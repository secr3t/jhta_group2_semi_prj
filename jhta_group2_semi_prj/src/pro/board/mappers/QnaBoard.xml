<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="QueBoard">

<typeAlias alias="questionboard" type="pro.qna.vo.Qna"/>
	
<insert id="addQueBoard" parameterClass="questionboard">
	insert into qna
	(qna_no, qna_title, qna_ques_content, qna_ans_content,
	  qna_active, course_no, student_no)
	values
	(qna_no_seq.nextval, #title#, #quesContent#, #ansContent#,
		#active#, #course.no#, #student.no#)
</insert>

<select id="getAllQueBoard" resultClass="questionboard">
	select
		A.qna_no					as no, 
		A.qna_title					as title, 
		A.qna_ques_content			as quesContent,
		A.qna_ques_date				as quesDate,
		A.qna_ans_content				as	ansContent,
		A.qna_ans_regdate				as	ansRegdate,
	  	A.qna_active					as	active, 
	  	A.course_no					as	"course.no", 
	  	A.student_no					as  "student.no",
	  	B.student_name				as	"student.name",
	  	C.course_name				as	"course.name"
	from
		qna A, student B, course C
	where 
		A.student_no = B.student_no
	and 
		A.course_no = C.course_no
	order by 
		qna_no desc
</select>

<delete id="deletequeBoardByNo" parameterClass="int">
	delete from qna
	where qna_no = #value#
</delete>

<select id="getQnaBoardByNo" parameterClass="int" resultClass="questionboard">
select
		A.qna_no						as no, 
		A.qna_title					as title, 
		A.qna_ques_content			as quesContent,
		A.qna_ques_date				as quesDate,
		A.qna_ans_content				as	ansContent,
		A.qna_ans_regdate				as	ansRegdate,
	  	A.qna_active					as	active, 
	  	A.course_no					as	"course.no", 
	  	A.student_no					as  "student.no",
	  	B.course_name				as	"course.name",
		C.lecturer_name				as	"course.lecturer.name"
	from
		qna A, course B, lecturer C 
	where
		A.course_no = B.course_no 
	and	
		B.lecturer_no = C.lecturer_no
	and
		A.qna_no = #value#
</select>

<update id="updateQnaAnsBoard" parameterClass="questionboard">
update qna
	set
		qna_ans_content = #ansContent#,
		qna_ans_regdate = sysdate
	where
		qna_no = #no#
</update>

</sqlMap>